!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Immutable"),require("PubSub")):"function"==typeof define&&define.amd?define(["Immutable","PubSub"],t):"object"==typeof exports?exports.CsCollection=t(require("Immutable"),require("PubSub")):e.CsCollection=t(e.Immutable,e.PubSub)}(this,function(e,t){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(4),f=r(a),l=function(){function e(t,n,r){if(i(this,e),!t||"object"!=("undefined"==typeof t?"undefined":o(t)))return void console.error("没有配置或者配置错误");window.collectionConfig=t,window.collectionI18n=n||"en","string"==typeof r?window.collectionMock=JSON.parse(r):window.collectionMock=r||{millis:34,code:"SUCCESS",message:"操作成功",entity:""};var u=window.localStorage.getItem("oldUrl")||"",a=!1;u.includes("mock")!=location.href.includes("mock")&&(a=!0,window.localStorage.setItem("oldUrl",location.href)),a&&window.localStorage.setItem("db","{}"),window.db={};var l=window.localStorage.getItem("db")||"{}";l=JSON.parse(l);for(var c in t){var s=!1;for(var d in l)d===c&&(s=!0);var y=[];s&&(y=l[c].items),window.db[c]=new f["default"](c,y)}}return u(e,[{key:"setCollectionI18n",value:function(e){window.collectionI18n=e||"en"}}]),e}();t["default"]=l},function(t,n){t.exports=e},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(1),c=n(9),s=r(c),d=function(e){function t(){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u(t,e),f(t,null,[{key:"getList",value:function(e){return Array.isArray(e)?(0,l.List)(e):l.List.of()}},{key:"isMap",value:function(e){return l.Map.isMap(e)}},{key:"isList",value:function(e){return l.List.isList(e)}},{key:"getParamObj",value:function(e,n){var r={};if("object"==("undefined"==typeof e?"undefined":a(e)))r=n[1]?t.withoutKeyObj(e,n[0]):n[0]?t.getKeyObj(e,n[0]):e;else{if("string"!=typeof e)return!1;r=e}return!r||$.isEmptyObject(r)?(console.error("参数为空"),!1):r}},{key:"setLocalData",value:function(e,t){window.db[e].items=t,window.localStorage.setItem("db",JSON.stringify(window.db))}},{key:"updateData",value:function(e,n,r){var i=window.db&&window.db[e].items;if(i&&i.size>0){var o=function(){var o=(0,l.List)(),u=(0,l.List)();return i.forEach(function(e,t){if(e[r]==n[r]){var a;!function(){var r=(0,l.Map)(e);for(a in n)r.map(function(e,t){t==a&&(u=r.set(a,n[a]))});var f=u.toObject();f.cacheTime=(new Date).getTime(),o=i.set(t,f)}()}}),o&&o.size>0?t.setLocalData(e,o):console.error("更改的数据不存在！"),{v:u.toObject()}}();if("object"===("undefined"==typeof o?"undefined":a(o)))return o.v}else console.error("更改的数据不存在！")}},{key:"removeData",value:function(e,n,r){var i=window.db&&window.db[e].items;if(i&&i.size>0){var o=(0,l.List)(),u=!1,a=void 0;return i.forEach(function(e,t){e[r]==n&&(u=!0,o=i.remove(t),a=e)}),u?t.setLocalData(e,o):console.error("删除的数据不存在！"),a}console.error("删除的数据不存在！")}},{key:"getKeyObj",value:function(e,n){if(e&&!t.isEmpty(e)&&n){var r={},i=[];n.constructor==String?i.push(n):n.constructor==Array&&(i=n);for(var o=0;o<i.length;o++){var u=i[o];l.Map.isMap(e)?void 0!=e.get(u)&&(r[u]=e.get(u)):e.constructor==Object?void 0!=e[u]&&(r[u]=e[u]):e.constructor==Array&&void 0!=e[0][u]&&(r[u]=e[0][u])}return r}}},{key:"getListKeyObj",value:function(e,n){if(e&&n){for(var r=[],i=0;i<e.length;i++){var o=this.getKeyObj(e[i],n);t.isEmpty(o)||r.push(o)}return r}}},{key:"filterListKey",value:function(e,n){if(e&&!t.isEmpty(e)&&n)return l.List.isList(e)?this.filterMapListKey(e,n):e.constructor==Array?this.filterMapListKey((0,l.List)(e),n):void 0}},{key:"filterMapListKey",value:function(e,t){if(e&&t&&l.List.isList(e)){var n=(0,l.Map)(t),r=e.filter(function(e){var t=!0;return n.map(function(n,r){n!=(0,l.Map)(e).get(r)&&(t=!1)}),t});return r}}},{key:"withoutKeyObj",value:function(e,n){if(e&&!t.isEmpty(e)&&n){var r;if(l.Map.isMap(e))r=this.withoutMapKeyObj(e,n);else if(e.constructor==Object){var i=(0,l.Map)(e);r=this.withoutMapKeyObj(i,n)}else if(e.constructor==Array){r=[];for(var o=0;o<e.length;o++){var u=this.withoutMapKeyObj((0,l.Map)(e[o]),n);r.push(u)}}return r}}},{key:"withoutMapKeyObj",value:function(e,t){if(e&&t&&l.Map.isMap(e)){var n;if(t.constructor==String)n=e.filterNot(function(e,n){return t==n});else if(t.constructor==Array){var r=(0,l.List)(t);n=e.filterNot(function(e,t){return r.includes(t)})}return n.toObject()}}}]),t}(s["default"]);t["default"]=d},function(e,n){e.exports=t},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(6),f=r(a),l=n(2),c=r(l),s=n(7),d=r(s),y=n(3),b=r(y),v=function(){function e(t,n){i(this,e),this.id=c["default"].uuid(),this.colName=t,this.items=c["default"].getList(n),this.widgets=[]}return u(e,[{key:"bindWidget",value:function(e,t){var n={};return n.id=e,n.colName=this.colName,n.pubsubKey=this.colName+"."+e,n.findOne=this.findOne.bind(n),n.find=this.find.bind(n),n.insert=this.insert.bind(n),n.update=this.update.bind(n),n.remove=this.remove.bind(n),n.pubsub=b["default"].subscribe(n.pubsubKey,t),n.unsubscribe=function(){b["default"].unsubscribe(n.pubsub)},this.widgets.push({widget:n}),n}},{key:"findOne",value:function(t,n){var r=this,i={};if(t&&"object"==("undefined"==typeof t?"undefined":o(t)))for(var u in t){var a=t[u];if("object"!=("undefined"==typeof a?"undefined":o(a)))i[u]=a;else for(var l in a){var c=a[l];if(0!=l.indexOf("$"))return!1;var s=l;try{var y=d["default"][s](c);if(!y)return!1;i[u]=y}catch(v){return!1}}}e.clearCacheData(this.colName,"findOne");for(var p=db[this.colName].widgets,m=0;m<p.length;m++)p[m].widget.id==this.id&&(p[m].query=t);if(!f["default"].isMock)return f["default"].findOne.bind(this)(this.colName,t,n).then(function(e){b["default"].publish(r.pubsubKey,e.nowItems)}.bind(this));var h=f["default"].findOne.bind(this)(this.colName,t,n);if(h){if("function"==typeof h.then)return h.then(function(e){b["default"].publish(r.pubsubKey,e.nowItems)}.bind(this));b["default"].publish(this.pubsubKey,h.nowItems)}}},{key:"find",value:function(t,n,r){var i=this,u={};if(t&&"object"==("undefined"==typeof t?"undefined":o(t)))for(var a in t){var l=t[a];if("object"!=("undefined"==typeof l?"undefined":o(l)))u[a]=l;else for(var c in l){var s=l[c];if(0!=c.indexOf("$"))return!1;var y=c;try{var v=d["default"][y](s);if(!v)return!1;u[a]=v}catch(p){return!1}}}e.clearCacheData(this.colName,"find");for(var m=db[this.colName].widgets,h=0;h<m.length;h++)m[h].widget.id==this.id&&(m[h].query=u);if(!f["default"].isMock)return f["default"].find.bind(this)(t,u,n,r).then(function(e){b["default"].publish(i.pubsubKey,e.nowItems)}.bind(this));var w=f["default"].find.bind(this)(t,u,n,r);if(w){if("function"==typeof w.then)return w.then(function(e){b["default"].publish(i.pubsubKey,e.nowItems)}.bind(this));var g=$.Deferred();return b["default"].publish(this.pubsubKey,w.nowItems),g.resolve(),g.promise()}}},{key:"insert",value:function(t,n){var r=this;if(e.clearCacheData(this.colName,"insert"),f["default"].isMock){var i=f["default"].insert.bind(this)(this.colName,t,n);if(i){if("function"==typeof i.then)return i.then(function(e){b["default"].publish(r.pubsubKey,e.nowItems)}.bind(this));b["default"].publish(this.pubsubKey,i.nowItems)}}else{var u,a=function(){var i=f["default"].getRequestNum(r.colName),o=1,a=f["default"].insert.bind(r)(r.colName,t,n).then(function(t){b["default"].publish(r.pubsubKey,t.nowItems),e.publishRelated(r.colName)}.bind(r));return i>1&&(u=setInterval(function(){o==i-1&&clearInterval(u),f["default"].insert(this.colName,t,n),o++}.bind(r),50)),{v:a}}();if("object"===("undefined"==typeof a?"undefined":o(a)))return a.v}}},{key:"update",value:function(t,n){var r=this;if(e.clearCacheData(this.colName,"update"),!f["default"].isMock)return f["default"].update.bind(this)(this.colName,t,n).then(function(t){b["default"].publish(r.pubsubKey,t.nowItems),e.publishRelated(r.colName)}.bind(this));var i=f["default"].update.bind(this)(this.colName,t,n);if(i){if("function"==typeof i.then)return i.then(function(e){b["default"].publish(r.pubsubKey,e.nowItems)}.bind(this));b["default"].publish(this.pubsubKey,i.nowItems)}}},{key:"remove",value:function(t,n){var r=this;if(e.clearCacheData(this.colName,"remove"),f["default"].isMock){var i=f["default"].remove.bind(this)(this.colName,t,n);if(i){if("function"==typeof i.then)return i.then(function(e){b["default"].publish(r.pubsubKey,e.nowItems)}.bind(this));b["default"].publish(this.pubsubKey,i.nowItems)}}else{var u,a=function(){var i=f["default"].getRequestNum(r.colName),o=1,a=f["default"].remove.bind(r)(r.colName,t,n).then(function(t){b["default"].publish(r.pubsubKey,t.nowItems),e.publishRelated(r.colName)}.bind(r));return i>1&&(u=setInterval(function(){o==i-1&&clearInterval(u),f["default"].remove(this.colName,t,n),o++}.bind(r),50)),{v:a}}();if("object"===("undefined"==typeof a?"undefined":o(a)))return a.v}}}],[{key:"publishRelated",value:function(e){for(var t=window.db&&window.db[e]&&window.db[e].widgets,n=window.db&&window.db[e]&&window.db[e].items,r=0;r<t.length;r++){var i=t[r].query,o=c["default"].filterListKey(n,i);o&&b["default"].publish(t[r].widget.pubsubKey,o)}}},{key:"clearCacheData",value:function(e,t){var n=f["default"].getCacheTimeOut(e),r=(new Date).getTime(),i=window.db&&window.db[e].items.toArray(),o=[];for(var u in i){var a=i[u].cacheTime;n!=-1&&r-n>a&&o.push(u)}o=o.reverse();for(var u=0;u<o.length;u++)i.splice(o[u],1);c["default"].setLocalData(e,c["default"].getList(i))}}]),e}();t["default"]=v},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(8),l=r(f),c=function(){function e(){o(this,e)}return a(e,null,[{key:"getKeyItems",value:function(e){var t=[];for(var n in e)t.push(n);return t}},{key:"mockUUID",value:function(t,n,r){if("object"===("undefined"==typeof t?"undefined":u(t))){var i=e.getKeyItems(t)[0],o=t[i].length||32,a="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678";return t[i]=e.getRandomString(o,a),n[r]=t,n}}},{key:"createMockContent",value:function(t,n){var r=JSON.parse(JSON.stringify(t));if("object"===("undefined"==typeof r?"undefined":u(r))){var o=function(){var t=e.getKeyItems(r),o=l["default"][e.mockLevel]||l["default"][e.level_1];return t.forEach(function(t,a){if($.isArray(r[t])){var f=[],l=e.getRandomlength(o.array);if("object"===u(r[t][0]))for(var c=0;c<l;c++){var s={};for(var d in r[t][0])s=$.extend(s,i({},d,e.getItemValue(n[d],o)));f.push(s)}else for(var c=0;c<l;c++)f.push(e.getItemValue(r[t][0],o));r[t]=f}else r[t]=e.getItemValue(n[t],o)}),{v:r}}();if("object"===("undefined"==typeof o?"undefined":u(o)))return o.v}}},{key:"getItemValue",value:function(t,n){var r="";if("string"===t){var i=window.collectionI18n;r=e.getSpecialItem(i,n[i])}else if("int"===t)r=e.getSpecialItem("int",n["int"]);else if("money"===t){var o=e.getSpecialItem("int",n["int"]);r=parseFloat(o/100).toFixed(2)}else if("time"===t)r=(new Date).getTime();else if($.isArray(t)){var u=Math.floor(Math.random()*t.length);r=t[u]}return r}},{key:"getRandomlength",value:function(e){if(e&&2==e.length){var t=e[1]-e[0]+1,n=Math.random();return e[0]+Math.round(n*t)}}},{key:"getRandomString",value:function(e,t){for(var n=t.length,r="",i=0;i<e;i++)r+=t.charAt(Math.floor(Math.random()*n));return r}},{key:"getSpecialItem",value:function(t,n){if(t&&n){if("int"==t){var r=e.getRandomlength(n),i="0123456789";return parseInt(e.getRandomString(r,i))}if("en"==t){var o=e.getRandomlength(n),u="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678";return e.getRandomString(o,u)}if("zh"==t){for(var a=new Array,f=e.getRandomlength(n),l=0;l<f;l++)a[l]=Math.round(20927*Math.random())+19968;var c=new Array;for(var l in a)c.push(String.fromCodePoint(a[l]));return c.join("")}}}}]),e}();c.level_1="level_1",c.level_2="level_2",c.level_3="level_3",c.mockLevel=function(){var e=location.href;if(e.includes("mock")){var t=e.indexOf("mock")+5,n=e.indexOf("&",t);return n<0&&(n=e.length),e.substring(t,n)||c.level_1}}(),t["default"]=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(5),f=r(a),l=n(2),c=r(l),s=n(1),d=n(3),y=r(d),b=function(){function e(){o(this,e)}return u(e,null,[{key:"isMockUrl",value:function(e,t){var n=window.collectionConfig[e],r=n&&n[t],i=r&&r.mockUrl||"";return i}},{key:"getStoreParam",value:function(e,t){var n=window.collectionConfig[e],r=n&&n[t],i=r&&r.storeParam||"entity";return i}},{key:"mock",value:function(t,n,r){var i=window.collectionConfig[t],o=i&&i[n],u=o&&o["return"],a=i&&i.entity&&i.entity.fields,l=o&&o.structure||{millis:32,code:"SUCCESS",message:"操作成功",entity:""},c=e.getStoreParam(t,n),s=e.getPrimaryKey(t);if(!u||$.isEmptyObject(u)){var d=e.isMockUrl(t,n);return d?d:window.collectionMock}if(u.hasOwnProperty(s)&&1==e.getObjLength(u))return f["default"].mockUUID(u,l,c);if(u&&a){var y=f["default"].createMockContent(u,a);return l[c]=y,l}}},{key:"getObjLength",value:function(e){var t=0;for(var n in e)t++;return t}},{key:"getUrl",value:function(e,t,n,r){var i=window.collectionConfig[e],o=i&&i[t];return o&&o.getUrl(n,r)}},{key:"getReturnChain",value:function(e,t){var n=window.collectionConfig[e],r=n&&n[t];return r&&r.returnChain}},{key:"getCacheTimeOut",value:function(e){var t=window.collectionConfig[e];return t&&t.cacheTimeOut}},{key:"getRequestNum",value:function(e){var t=window.collectionConfig[e];return t&&t.requestNum}},{key:"getIsMongoQuery",value:function(e){var t=window.collectionConfig[e];return!!t.isMongoQuery&&t.isMongoQuery}},{key:"getPrimaryKey",value:function(e){var t=window.collectionConfig[e],n=t&&t.entity;return n&&n.primaryKey}},{key:"getParamValue",value:function(e,t){if(!e||!t)return!1;var n=c["default"].getKeyObj(e,t);return n?n[t]:(console.error("找不到该key值"),!1)}},{key:"getPrimaryKeyValue",value:function(t,n){var r="";if("string"==typeof n)r=n;else{var i=e.getPrimaryKey(t);r=e.getParamValue(n,i)}return r?r:(console.error("找不到主键值"),!1)}},{key:"getNowdbData",value:function(t,n,r,i,o){var u=[],a=e.getStoreParam(t,r),f=i[a];if(n){var l=n.split(".");u=i;for(var c=0;c<l.length;c++)u=u[l[c]]}else if(f[o])u=f;else for(var c in f)f[c]&&f[c].length>0&&(u=f[c]);return"findOne"==r&&u&&u.length>0&&(u=u[0]),u}},{key:"isInsert",value:function(e,t,n,r){var i=!0,o=window.db&&window.db[e]&&window.db[e].items,u=(0,s.List)();return o&&o.size>0&&o.forEach(function(e,a){if(e[r]==n[r]&&(i=!1,"findOne"==t)){var f=$.extend({},e,n);u=o.set(a,f)}}),"findOne"==t?$.extend({isInsert:i},{extend:u}):i}},{key:"getDataKey",value:function(e,t){var n=window.collectionConfig[e];return n&&n[t]&&n[t].include?[n&&n[t]&&n[t].include,!1]:n&&n[t]&&n[t].exclusive?[n&&n[t]&&n[t].exclusive,!0]:["",!1]}},{key:"findOne",value:function(t,n,r){var i=this,o="findOne";if(e.isMock){var u=e.mock(t,o,n);return"string"==typeof u?$.getJSON(u,null,function(n){e.setFindOneData(t,o,n)}):e.setFindOneData(t,o,u)}var a=e.getIsMongoQuery(t),f=e.getPrimaryKey(t),l=e.getPrimaryKeyValue(t,n);if(db&&db.size>0&&db.forEach(function(e,t){e[f]==l&&y["default"].publish(i.pubsubKey,(0,s.Map)(e))}),a)var c="/"+t+"?query="+n;else var c=e.getUrl(t,"findOne",l,r);return $.get(c,null,function(n){"SUCCESS"===n.code&&e.setFindOneData(t,o,n)})}},{key:"setFindOneData",value:function(t,n,r){var i=e.getReturnChain(t,n),o=e.getPrimaryKey(t),u=e.getNowdbData(t,i,n,r,o);if(!u)return void console.error(t+"返回链"+i+"，配置有误！");u.cacheTime=(new Date).getTime();var a=e.isInsert(t,n,u,o),f=window.db&&window.db[t]&&window.db[t].items;return a.isInsert&&f&&c["default"].setLocalData(t,window.db[t].items.push(u)),!a.isInsert&&f&&c["default"].setLocalData(t,a.extend),r.nowItems=(0,s.Map)(u),r}},{key:"find",value:function(t,n,r,i){var o=this,u="find";if(e.isMock){var a=e.mock(this.colName,u,n);return"string"==typeof a?$.getJSON(a,null,function(t){e.setFindData(o.colName,u,t)}):e.setFindData(this.colName,u,a)}var f=window.db&&window.db[this.colName]&&window.db[this.colName].items,l=c["default"].filterListKey(f,n);l&&y["default"].publish(this.pubsubKey,l);var s=e.getIsMongoQuery(this.colName);if(s)var d="/"+this.colName+"?query="+t;else var d=e.getUrl(this.colName,u,r,i);return $.get(d,n,function(t){"SUCCESS"===t.code&&e.setFindData(o.colName,u,t)})}},{key:"setFindData",value:function(t,n,r){var i=e.getReturnChain(t,n),o=e.getPrimaryKey(t),u=e.getNowdbData(t,i,n,r,o);if(window.db[t].result=r,!u)return void console.error(t+"返回链"+i+"，配置有误！");var a=window.db&&window.db[t]&&window.db[t].items;if(a&&a.size>0){var f=(0,s.List)();for(var l in u){var d=!0;a=f.size>0?f:a,a.forEach(function(e,t){u[l].cacheTime=(new Date).getTime(),e[o]==u[l][o]&&(d=!1,f=a.set(t,u[l]))}),d?c["default"].setLocalData(t,window.db[t].items.push(u[l])):c["default"].setLocalData(t,f)}}else if(a)for(var y in u)u[y].cacheTime=(new Date).getTime(),c["default"].setLocalData(t,window.db[t].items.push(u[y]));return r.nowItems=(0,s.List)(u),r}},{key:"insert",value:function(t,n,r){var i="insert",o=e.getDataKey(t,i),u=c["default"].getParamObj(n,o);if(e.isMock){var a=e.mock(t,i,n);return"string"==typeof a?$.getJSON(a,null,function(n){e.setInsertData(t,i,n,u)}):e.setInsertData(t,i,a,u)}return $.post(e.getUrl(t,i,n,r),u,function(n){"SUCCESS"===n.code&&e.setInsertData(t,i,n,u)})}},{key:"setInsertData",value:function(t,n,r,o){var u=e.getPrimaryKey(t),a=e.getStoreParam(t,n),f=r[a],l=e.isInsert(t,n,f,u);if(l){var c=$.extend({cacheTime:(new Date).getTime()},o,i({},u,f[u])),d=window.db&&window.db[t]&&window.db[t].items;return d&&(window.db[t].items=window.db[t].items.push(c),window.localStorage.setItem("db",JSON.stringify(window.db))),r.nowItems=(0,s.Map)(c),r}console.error("已存在此数据，不能重复新建！")}},{key:"update",value:function(t,n,r){var i="update";if(e.isMock){var o=e.mock(t,i,n);return"string"==typeof o?$.getJSON(o,null,function(r){e.setUpdateData(t,i,r,n)}):e.setUpdateData(t,i,o,n)}var u=e.getDataKey(t,i),a=c["default"].getParamObj(n,u),f=e.getPrimaryKeyValue(t,n);return $.put(e.getUrl(t,i,f,r),a,function(r){"SUCCESS"===r.code&&e.setUpdateData(t,i,r,n)})}},{key:"setUpdateData",value:function(t,n,r,i){var o=e.getPrimaryKey(t),u=e.getStoreParam(t,n),a=r[u];return a&&a.length>0?(r.nowItems=(0,s.Map)(c["default"].updateData(t,a,o)),r):(r.nowItems=(0,s.Map)(c["default"].updateData(t,i,o)),r)}},{key:"remove",value:function(t,n,r){var i="remove",o=e.getPrimaryKey(t),u=e.getPrimaryKeyValue(t,n);if(e.isMock){var a=e.mock(t,i,n);return"string"==typeof a?$.getJSON(a,null,function(e){e.nowItems=(0,s.Map)(c["default"].removeData(t,u,o))}):(a.nowItems=(0,s.Map)(c["default"].removeData(t,u,o)),a)}return $["delete"](e.getUrl(t,i,u,r),null,function(e){"SUCCESS"===e.code&&(e.nowItems=(0,s.Map)(c["default"].removeData(t,u,o)))})}}]),e}();b.initJquery=function(){$.ajaxSetup({cache:!1}),$(document).ajaxSend(function(e,t,n){}),$(document).ajaxSuccess(function(e,t,n){}),$(document).ajaxError(function(e,t,n,r){}),jQuery.each(["put","delete"],function(e,t){jQuery[t]=function(e,n,r,i){return jQuery.isFunction(n)&&(i=i||r||"json",r=n,n=void 0),jQuery.ajax({url:e,type:t,dataType:i,data:n,success:r})}})}(),b.isMock=function(){var e=!1,t=location.href;return t.includes("mock")&&(e=!0),e}(),t["default"]=b},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){n(this,e)}return r(e,null,[{key:"$in",value:function(e){return!!Array.isArray(e)&&e.toString()}}]),e}();t["default"]=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={level_1:{en:[5,50],zh:[1,20],"int":[1,10],array:[0,20]},level_2:{en:[50,100],zh:[20,80],"int":[10,20],array:[20,80]},level_3:{en:[100,200],zh:[80,150],"int":[20,100],array:[80,150]}}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),a=function(){function e(){r(this,e)}return o(e,null,[{key:"pushPollFuns",value:function(t){var n=t;"object"===("undefined"==typeof t?"undefined":i(t))&&(n=t.func),"function"==typeof n&&e.pollFuns.push(t)}},{key:"getKey",value:function(t){var n=(t||"key")+"_";return e.key=e.key+1,n+e.key}},{key:"uuid",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}},{key:"isEmpty",value:function(e){if(!e)return!0;if(u.List.isList(e)||u.Map.isMap(e))return!(e.size>1);if(this.isArray(e))return 0==e.length;if(this.isObject(e)){for(var t in e)return!1;return!0}return!1}},{key:"isObject",value:function(e){var t="undefined"==typeof e?"undefined":i(e);return"function"===t||"object"===t&&!!e}},{key:"isArray",value:function(e){return Array.isArray(e)||"[object Array]"===toString.call(e)}}]),e}();a.pollFuns=[],a.poll=function(){setInterval(function(){for(var e in a.pollFuns){var t=a.pollFuns[e];"function"==typeof t?t():(t.cur=(t.cur||t.delay)-1,t.cur<1&&("function"==typeof t.func&&t.func(),t.cur=t.delay))}},1e3)}(),a.key=0,t["default"]=a}])});